<?xml version="1.0" encoding="utf-8"?>
<MedicationRequest xmlns="http://hl7.org/fhir">
    <id value="medicationrequest-warfarin-nsaid-warfarin-prefetch"/>
    <status value="active"/>
    <intent value="order"/>
    <category>
        <coding>
            <code value="outpatient"/>
        </coding>
    </category>
    <medicationCodeableConcept>
        <coding>
            <system value="http://www.nlm.nih.gov/research/umls/rxnorm"/>
            <code value="855295"/>
            <display value="Warfarin Sodium 10 MG"/>
        </coding>
    </medicationCodeableConcept>
    <subject>
        <reference value="Patient/warfarin-nsaid-over65-prefetch"/>
    </subject>
    <context>
        <reference value="Encounter/warfarin-nsaid-prefetch"/>
    </context>
    <authoredOn>
        <extension url="http://hl7.org/fhir/StructureDefinition/cqf-expression">
            <valueExpression>
              <language value="text/cql"/>
            <expression value="Today() - 90 days"/>
            </valueExpression>
        </extension>
    </authoredOn>
    <dosageInstruction>
        <timing>
            <repeat>
                <frequency value="1"/>
                <period value="1.0"/>
                <periodUnit value="d"/>
            </repeat>
        </timing>
        <asNeededBoolean value="false"/>
        <doseAndRate>
            <type>
              <coding>
                <code value="calculated"/>
              </coding>
            </type>
			<doseQuantity>
				<value value="1.0"/>
				<unit value="tablet"/>
			</doseQuantity>
		</doseAndRate>
    </dosageInstruction>
    <dispenseRequest>
        <validityPeriod>
        <extension url="http://hl7.org/fhir/StructureDefinition/cqf-expression">
            <valueExpression>
              <language value="text/cql"/>
                <expression value="FHIR.Period { start: FHIR.dateTime { value: Today() - 90 days }, end: FHIR.dateTime { value: Today() } }"/>
			</valueExpression>
            </extension>
        </validityPeriod>
        <numberOfRepeatsAllowed value="1"/>
        <expectedSupplyDuration>
            <value value="90"/>
            <unit value="d"/>
        </expectedSupplyDuration>
    </dispenseRequest>
</MedicationRequest>